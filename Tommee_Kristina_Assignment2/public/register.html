<!-- Author: Kristina Tommee-->
<!-- Description: This is the invoice page for my shop. I decided to create a separate 
  invoice page rather than generating directly from the server because it kept everything 
  in a separate place and makes everything look more clean-->
  
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="products-style.css">
    <title>Register Page</title>

    <script>
        window.onload = function () {
            let params = (new URL(document.location)).searchParams;
            the_user = params.get("username");
            console.log(the_user);
            has_errors = false; 
            if (the_user != null) {
                register.username.value = the_user;
                if (!usernameValidation(the_user)) {
                    has_errors = true;
                }
                //give an alert if there is an error or redirect to invoice if values are valid
                if (has_errors) {
                    alert("Please enter a valid username!");
                }
            }
            the_email = params.get("email");
            console.log(the_email);
            has_errors = false;
            if (the_email != null) {
                register.email.value = the_email;
                if (!emailValidation(the_email)) {
                    has_errors = true;
                }
                //give an alert if there is an error or redirect to invoice if values are valid
                if (has_errors) {
                    alert("Please enter a valid email!");
                }
            }
            the_fullname = params.get("fullname");
            console.log(the_fullname)
            has_errors = false
            if (the_fullname != null) {
                register.fullname.value = the_fullname;
                if (!fullnameValidation(the_fullname)) {
                    has_errors = true;
                }
                //give an alert if there is an error or redirect to invoice if values are valid
                if (has_errors) {
                    alert("Please enter a valid full name!");
                }
            }
            the_password = params.get("password");
            has_errors = false;
            if (!passwordValidation(the_password)) {
                has_errors = true;
            }
            //give an alert if there is an error or redirect to invoice if values are valid
            if (has_errors) {
                alert("Please enter a valid password!");
            }

            the_passwordRepeat = params.get("repeatPassword");
            the_password = params.get("password");
            has_errors = false;
            if (the_passwordRepeat != the_password){
                has_errors = true;
            }


            if (has_errors) {
                alert("Password repeat doesn't match password!");
            }

            register.registerSubmit.value = "Continue"; 
            
            /*the_passwordRepeat = params.get("repeatPassword");
            if (!passwordRepeatValidation(the_password)) {
                has_errors = true;
            }
            //give an alert if there is an error or redirect to invoice if values are valid
            if (has_errors) {
                alert("Passwords must match!");
            }
            */
        }
        
        /*
window.onload = function () {
               let params = (new URL(document.location)).searchParams;
               the_user = params.get("username");
               console.log("Here is " + the_user);
               if (the_user != null) {
                   username_errs = usernameValidation(the_user.toLowerCase(), true);
               }
               // if the username errors array = 0, meaning that there is nothing in the array, then good! if not, send the array back through the span (document.getElementbyId)
               if (username_errs.length != 0) {
                   document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
               }
           }
                    username_errs = usernameValidation(the_user.toLowerCase(), true);
                }
                // if the username errors array = 0, meaning that there is nothing in the array, then good! if not, send the array back through the span (document.getElementbyId)
                if (username_errs.length != 0) {
                    document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
                }
            }
        */
        // Source: Port Assignment 1 Example 
        // Creates an alert when quantity is invalid; directs to invoice if quantity is valid
        /* window.onload = function () {
            let params = (new URL(document.location)).searchParams; // gets query string + form data
            // when form is submitted, check if quantities are valid then redirect to invoice
            if (params.has('register_submit_button')) {
                has_errors = false; // assume quantities are valid
                if (params.has("username")) {
                    the_user = params.get("username");
                    register.username.value = the_user;
                    if (!usernameValidation(the_user)) {
                        has_errors = true;
                    }
                    //give an alert if there is an error or redirect to invoice if values are valid
                    if (has_errors) {
                        alert("Please enter only valid quantities.");
                    }
                }
            }
        }
        */
        // Source: Lab 13 order_page_Ex4.html
        // Function used along with isNonNegInt to validate non-negative integer; checking the value that is in the textbox
        function checkUsername(theTextbox) {
            errs = usernameValidation(theTextbox.value, true); // don't want a boolean; want the actual errors array
            document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
        }
        function checkPassword(theTextbox) {
            errs = passwordValidation(theTextbox.value, true); // don't want a boolean; want the actual errors array
            document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
        }
        function checkFullname(theTextbox) {
            errs = fullnameValidation(theTextbox.value, true); // don't want a boolean; want the actual errors array
            document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
        }
        function checkEmail(theTextbox) {
            errs = emailValidation(theTextbox.value, true); // don't want a boolean; want the actual errors array
            document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
        }
        /*function checkPasswordRepeat(theTextbox) {
            errs = passwordRepeatValidation(theTextbox.value, true); // don't want a boolean; want the actual errors array
            document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
        }
        */
        // Source: Lab 13 info_server_Ex4.js
        // validates to make sure that full name meets requirements 
        function usernameValidation(the_user, return_errors = false) {
            var letters = /^[0-9a-zA-Z]+$/;
            errors = []; // assume no errors at first
            // check if length is okay 
            if (the_user.length > 10 || the_user.length < 4) {
                errors.push('<font color="black">Username must be between 4 and 10 characters long!</font>');
            }
            // check if there are only letters and numbers
            if (!the_user.match(letters)) {
                // if contain characters that are not letters = error 
                errors.push('<font color="black">Username can only contain alphanumeric characters only!</font>');
            }
            return return_errors ? errors : (errors.length == 0);
        }
        // validates password; it should be of length 6 characters or greater). If not, it displays an alert.
        function passwordValidation(the_password, return_errors = false) {
            errors = []; // assume no errors at first
            if (the_password.length < 6) {
                errors.push('<font color="black">Password must be at least 6 characters long!</font>')
            }
            return return_errors ? errors : (errors.length == 0);
        }
        // validates password confirmation; should be the same value as password. If not, it displays an alert.
        /*function passwordRepeatValidation(the_passwordRepeat, return_errors = false) {
            //the_password = params.get("password");
            //the_passwordRepeat = params.get("repeatPassword");
            errors = []; // assume no errors at first
            //if (the_passwordRepeat != the_password) {
            if (the_passwordRepeat.value != the_password.value) {
                errors.push('<font color="black">Password must be the same for both password inputs!</font>')
            }
            return return_errors ? errors : (errors.length == 0);
        }
        */
        // validate fullname checks whether user name input field is provided with alphabates characters. If not, it displays an alert 
        function fullnameValidation(the_Fullname, return_errors = false) {
            errors = []; // assume no errors at first
            var letters = /^[A-Za-z ]+$/;
            if (!the_Fullname.match(letters)) {
                errors.push('<font color="black">Username can only contain letters</font>');
            }
            if (the_Fullname.length > 30) {
                errors.push('<font color="black">Full name must be less than 30 characters long!</font>');
            }
            return return_errors ? errors : (errors.length == 0);
        }
        // validate email format
        function emailValidation(the_email, return_errors = false) {
            errors = []; // assume no errors at first
            var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
            if (!the_email.match(mailformat)) {
                errors.push('<font color="black">You have entered an invalid email address!</font>');
            }
            return return_errors ? errors : (errors.length == 0);
        }
    </script>

</head>

<body>
    <h1>...Register Page...</h1>
    <!-- Takes you to the login page -->
    <b><a href="login.html">Already have an account? Click here to login!</a></b>
    <br>
    <br>
    <br>


    <form name="register" action="" method="POST">
        <input type="text" name="fullname" size="40" placeholder="enter full name (First Name Last Name)"
            onkeyup="checkFullname(this);"><span id="fullname_span"></span><br />
        <input type="text" name="username" size="40" placeholder="enter username" onkeyup="checkUsername(this);"><span
            id="username_span"></span><br />
        <input type="password" name="password" size="40" placeholder="enter password"
            onkeyup="checkPassword(this);"><span id="password_span"></span><br />
        <input type="password" name="repeatPassword" size="40" placeholder="enter password again"><span id="repeatPassword_span"></span><br />
        <input type="email" name="email" size="40" placeholder="enter email" onkeyup="checkEmail(this);"><span
            id="email_span"></span><br />
            <input type="submit" value="Submit" name= "registerSubmit"><span id="button_span"></span>
    </form>

    <script>
    </script>

    <br>
    <br>
    <br>

</body>

</html>

<script>
        // Source: Port Assignment 1 Example 
        // Creates an alert when quantity is invalid; directs to invoice if quantity is valid
    /* window.onload = function () {
let params = (new URL(document.location)).searchParams; // gets query string + form data
// when form is submitted, check if quantities are valid then redirect to invoice
if (params.has('register_submit_button')) {
 has_errors = false; // assume inputs are valid
 for (i = 0; i < products.length; i++) {
     if (params.has(`quantity${i}`)) {
         a_qty = params.get(`quantity${i}`);
         // make textboxes sticky in case of invalid data
         quantity_form[`quantity${i}`].value = a_qty;
         total_qty += a_qty;
         if (!isNonNegInt(a_qty)) {
             has_errors = true; // if there is invalid quantity
         }
     }
 }
 //give an alert if there is an error or redirect to invoice if values are valid
 if (has_errors) {
     alert("Please enter only valid quantities.");
 } else if (total_qty == 0) { //alert for no quantities chosen
     alert("Please select some quantities for the items you want to purchase.");
 } else { // redirecting to invoice when quantities are valid
     window.location = `./product_invoice.html${document.location.search}`;
     window.stop;
 }
}
}
 // Source: Lab 13 order_page_Ex4.html
        // Function used along with isNonNegInt to validate non-negative integer; checking the value that is in the textbox
        //function check(theTextbox) {
            //errs = usernameValidation(theTextbox.value, true); // don't want a boolean; want the actual errors array
            //document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
        }
        //document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
  window.onload = function () {
            let params = (new URL(document.location)).searchParams; // gets query string + form data
            // when form is submitted, check if quantities are valid then redirect to invoice
            has_errors = false; // assume quantities are valid
            if (params.has("username")) {
                    the_user = params.get("username");
                    register["username"].value = the_user;
            if(!usernameValidation(the_user)){
                has_errors = true;
            }
            //give an alert if there is an error or redirect to invoice if values are valid
            if (has_errors) {
                alert("Please enter only valid quantities.");
            }
        }
        }
        window.onload = function () {
               let params = (new URL(document.location)).searchParams;
               the_user = params.get("username");
               console.log("Here is " + the_user);
               if (the_user != null) {
                   username_errs = usernameValidation(the_user.toLowerCase(), true);
               }
               // if the username errors array = 0, meaning that there is nothing in the array, then good! if not, send the array back through the span (document.getElementbyId)
               if (username_errs.length != 0) {
                   document.getElementById(theTextbox.name + '_span').innerHTML = errs.join(", "); // get the errors array and turn it into a string
               }
           }
     let params = (new URL(document.location)).searchParams;
        the_user = params.get("username");
        the_password = params.get("password");
        the_fullname = params.get("fullname");
        the_email = params.get("email");
        if (the_user != null) {
            login.username.value = the_user;
        }
        if (the_password != null) {
            login.password.value = the_password;
        }
        if (the_fullname != null) {
            login.fullname.value = the_fullname;
        }
        if (the_email != null) {
            login.email.value = the_email;
        }
*/
</script>